/*               
            ░███████╗██╗███╗░░██╗██╗██╗░░░░░██╗███████╗███╗░░██╗   ░██████╗███╗░░██╗██╗██████╗░███████╗██████╗░░
			░██╔════╝██║████╗░██║██║████░░████║██╔════╝████╗░██║   ██╔════╝████╗░██║██║██╔══██╗██╔════╝██╔══██╗░
			░███████╗██║██╔██╗██║██║██║░██░░██║█████╗░░██╔██╗██║   ╚█████╗░██╔██╗██║██║██████╔╝█████╗░░██████╔╝░
			░██╔════╝██║██║╚████║██║██║░░░░░██║██╔══╝░░██║╚████║   ░╚═══██╗██║╚████║██║██╔═══╝░██╔══╝░░██╔══██╗░
			░██║░░░░░██║██║░╚███║██║██║░░░░░██║███████╗██║░╚███║   ██████╔╝██║░╚███║██║██║░░░░░███████╗██║░░██║░
			░╚═╝░░░░░╚═╝╚═╝░░╚══╝╚═╝╚═╝░░░░░╚═╝╚══════╝╚═╝░░╚══╝   ╚═════╝░╚═╝░░╚══╝╚═╝╚═╝░░░░░╚══════╝╚═╝░░╚═╝░
____________________________________________________________________________________________________________________________________________
                █▀▀▄ █──█ 　 ▀▀█▀▀ █──█ █▀▀ 　 ░█▀▀▄ █▀▀ ▀█─█▀ █▀▀ █── █▀▀█ █▀▀█ █▀▀ █▀▀█ 
                █▀▀▄ █▄▄█ 　 ─░█── █▀▀█ █▀▀ 　 ░█─░█ █▀▀ ─█▄█─ █▀▀ █── █──█ █──█ █▀▀ █▄▄▀ 
                ▀▀▀─ ▄▄▄█ 　 ─░█── ▀──▀ ▀▀▀ 　 ░█▄▄▀ ▀▀▀ ──▀── ▀▀▀ ▀▀▀ ▀▀▀▀ █▀▀▀ ▀▀▀ ▀─▀▀
____________________________________________________________________________________________________________________________________________
*/
using UnityEngine;

namespace FinimenSniperC
{
    [DisallowMultipleComponent]
    internal class FigureUI : MonoBehaviour
    {
        [SerializeField] private Cell[] cells;

        private void Start()
        {
            foreach(Figure figure in Board.AllFigures)
            {
                figure.OnSelected += CreatePathUI;
            }

            BoardUI.Instance.OnClearUI += DeletLastPath;

            EventHolder.OnNewFigureCreated += AddNewFigure;
        }

        private void AddNewFigure(Figure figure)
        {
            figure.OnSelected += CreatePathUI;
        }

        private void CreatePathUI(Location[] availableCells, Figure figure)
        {
            DeletLastPath();

            cells = new Cell[availableCells.Length];

            for (int i = 0; i < availableCells.Length; i++)
            {
                Cell cell = Instantiate(BoardUI.Instance.CellPrefab, transform);

                LeanTween.alpha(cell.gameObject, .5f, .5f);

                cell.Location = availableCells[i];

                cell.CurrentFigure = figure;

                cell.ChangeColor();

                cells[i] = cell;
            }
        }

        private void DeletLastPath()
        {
            foreach(Cell cell in cells)
            {
                LeanTween.alpha(cell.gameObject, 0, .5f).destroyOnComplete = true;

                cell.enabled = false;
            }

            cells = new Cell[0];
        }
    }
}